# Simple Email Service

abbreviation: SES

CLI documentation

- [ses (version 1)](https://docs.aws.amazon.com/cli/latest/reference/ses/index.html)
- [sesv2](https://docs.aws.amazon.com/cli/latest/reference/sesv2/index.html)

```sh
# create an email template
# NOTE: we mistakenly used ses version 1, probably better to use sesv2
aws ses create-template --template '{"TemplateName":"EmailNewsletterWelcome","SubjectPart":"Welcome to Typescript Teatime","TextPart":"Welcome to the TypeScript Teatime Newsletter. Thanks for signing up. With this, you will never miss a new blog posts. Thanks, The TypeScript Team","HtmlPart":"<h1>Welcome to the TypeScript Teatime Newsletter</h1><p>Hello {{email}},\\nThanks for signing up. With this, you will never miss a new blog posts.</p><p>Thanks,\\nThe TypeScript Team</p>"}'

# get template (we will need the ARN for send email step)
aws sesv2 get-email-template --template-name "EmailNewsletterWelcome"
aws ses get-template --template-name "EmailNewsletterWelcome"

# create a contact list
aws sesv2 create-contact-list --cli-input-json file://ses/create-contact-list.json

# list contact lists
aws sesv2 list-contact-lists

# list contacts in a contact list (does not include attributes)
aws sesv2 list-contacts --contact-list-name "EmailNewsletter"

# add contact to a contact list (Note: fails if email already exists)
aws sesv2 create-contact --contact-list-name "EmailNewsletter" --email-address "typescriptteatime@gmail.com"

# add contact to a contact list with attributes
aws sesv2 create-contact --contact-list-name "EmailNewsletter" --email-address "typescriptteatime@gmail.com" --attributes-data '{"privacyPolicyAcceptedAt": "2022-09-11T16:12:36Z"}'

# get a contact from a contact list including attributes
aws sesv2 get-contact --contact-list-name "EmailNewsletter" --email-address 'typescriptteatime@gmail.com'

# delete contact from contact list
aws sesv2 delete-contact --contact-list-name "EmailNewsletter" --email-address "typescriptteatime@gmail.com"

aws sesv2 send-email --content '{"Template":{"TemplateName":"EmailNewsletterWelcome","TemplateArn":"arn:aws:ses:us-east-1:756399734264:template/EmailNewsletterWelcome","TemplateData":"{\"email\":\"typescriptteatime@gmail.com\"}"}}'
aws sesv2 send-email --list-management-options ContactListName=EmailNewsletter --from-email-address='typescriptteatime@gmail.com' --content '{"Template":{ "TemplateName":"EmailNewsletterWelcome","TemplateArn":"arn:aws:ses:us-east-1:756399734264:template/EmailNewsletterWelcome","TemplateData":"{\"email\":\"typescriptteatime@gmail.com\"}"}}' --configuration-set-name "DefaultConfigSet"

aws ses send-templated-email --destination ToAddresses=dopilij444@keyido.com --source 'typescriptteatime@gmail.com' --template 'EmailNewsletterWelcome' --template-data '{"email":"typescriptteatime@gmail.com"}'

## Using the SES-autogenerated unsubscribe link in the email footer
aws ses update-template --template '{"TemplateName":"EmailNewsletterWelcome","SubjectPart":"Welcome to Typescript Teatime","TextPart":"Welcome to the TypeScript Teatime Newsletter. Thanks for signing up. With this, you will never miss a new blog posts. Thanks, The TypeScriptTeatime Team. To unsubscribe, copy the following link into your browser address bar: {{amazonSESUnsubscribeUrl}}","HtmlPart":"<h1>Welcome to the TypeScript Teatime Newsletter</h1><p>Hello {{email}},</p><br><p>Thanks for signing up. With this, you will never miss a new blog posts.</p><p>Thanks,</p><br><p>Mirco from The TypeScript Teatime</p>"}'

# https://docs.aws.amazon.com/cli/latest/reference/sesv2/test-render-email-template.html

aws sesv2 test-render-email-template \
    --template-name EmailNewsletterWelcome \
    --template-data '{"email":"Hello"}'

# Bulk email sending
# https://docs.aws.amazon.com/cli/latest/reference/sesv2/send-bulk-email.html
# https://aws.amazon.com/blogs/messaging-and-targeting/introducing-email-templates-and-bulk-sending/
aws sesv2 send-bulk-email --cli-input-json file://send-bulk-email.input.json
```
